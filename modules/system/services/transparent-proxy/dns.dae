dns {
    ipversion_prefer: 4

    upstream {
        alibaba-doh: 'https://dns.alidns.com/dns-query'
        cloudflare-doh: 'https://cloudflare-dns.com/dns-query'
        google: 'tcp+udp://8.8.8.8:53'
    }

    routing {
        request {
            qname(full: dns.alidns.com) -> google
            qname(geosite:category-ads-all) -> reject
            qtype(https) -> reject
            qname(geosite:cn) -> alibaba-doh
            fallback: cloudflare-doh
        }

        response {
            upstream(google) -> accept
            upstream(cloudflare-doh) -> accept
            ip(geoip:private) && !qname(geosite:cn) -> cloudflare-doh
            fallback: accept
        }
    }
}
